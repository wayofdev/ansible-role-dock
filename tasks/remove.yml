---

- name: Dockutil | Get information on items to remove
  ansible.builtin.shell: "{{ dockutil_path }} --find '{{ item }}'"
  register: dockitems_current
  loop: "{{ dockutil.remove|flatten(levels=1) }}"
  changed_when: false
  failed_when: >
    "No such file or directory" in dockitems_current.stdout
    or "command not found" in dockitems_current.stdout
  check_mode: false
  when: not dockutil.remove_all|bool

- name: Dockutil | remove debug
  ansible.builtin.debug:
    msg: "{{ dockitems_current }}"

- name: Dockutil | Remove all dock items
  ansible.builtin.shell: "{{ dockutil_path }} --remove all"
  register: removed_items_task
  when: not dockutil.remove_all|bool

- name: Dockutil | Debug "remove" statement
  ansible.builtin.debug:
    msg: "{{ lookup('template', './templates/remove.j2') }} | replace('\n', '') | trim"
  loop_control:
    label: "{{ item.item }}"
  when: not dockutil.remove_all|bool

- name: Dockutil | Remove items only specified in delete list
  ansible.builtin.shell: "{{ lookup('template', './templates/remove.j2') }} | replace('\n', '') | trim"
  loop_control:
    label: "{{ item.item }}"
  when: not dockutil.remove_all|bool
